FROM python:alpine
MAINTAINER Kyle Arscott	"arscotkm@mcmaster.ca"

RUN adduser -h /home/badger -D badger sudo
ENV APPROOT="/home/badger/docker"
ENV DATABASE_SERVER_ADDRESS="192.168.999.shutup"
ENV SQLITE_DATABASE_FILE="/var/html/www/....../archive.sdb"
ENV PORT="6969"
WORKDIR $APPROOT
ADD . $APPROOT
EXPOSE 80
ENV NAME World
USER badger:badger
USER root

RUN apk add build-base git
RUN pip install pysqlite configobj Cheetah Pillow pyserial pyusb pyephem pipenv

RUN cd /home/badger/
RUN git clone https://github.com/beasley-weather/beasley-weather-station.git
RUN git clone https://github.com/beasley-weather/dts-server.git

# install weewx via Python 2.7 from a tar.gz file with the help of http://weewx.com/docs/macos.htm
RUN wget --directory-prefix=~/Downloads http://www.weewx.com/downloads/released_versions/weewx-3.6.2.tar.gz
RUN tar xvfz ~/Downloads/weewx-3.6.2.tar.gz
RUN cd ~/Downloads/weewx-3.6.2
RUN python2 setup.py install

RUN cd dts-server/
RUN pipenv install

# TODO how to run and rerun the below process, with CMD
# python-m dts_server $SQLITE_DATABASE_FILE